%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{CRMLXRMS Labs}
\date{Aug 06, 2024}
\release{}
\author{Amadeusz Nowak, Andrii Voznesenskyi, Piotr Padamczyk}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
Add your content using \sphinxcode{\sphinxupquote{reStructuredText}} syntax. See the
\sphinxhref{https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html}{reStructuredText}
documentation for details.

\sphinxstepscope


\chapter{Administration Concession System}
\label{\detokenize{administration_concession_system/index:administration-concession-system}}\label{\detokenize{administration_concession_system/index::doc}}
\sphinxstepscope


\section{Authorization Service}
\label{\detokenize{administration_concession_system/authorization_service:authorization-service}}\label{\detokenize{administration_concession_system/authorization_service::doc}}
\sphinxAtStartPar
The Authorization Microservice is a core component of the Administration Concession System. It handles authentication, authorization, and user management processes, which are essential for maintaining secure access and operational control. This microservice also integrates with the CRM system to share user data and operational events.


\subsection{API Documentation}
\label{\detokenize{administration_concession_system/authorization_service:api-documentation}}

\subsection{Commands}
\label{\detokenize{administration_concession_system/authorization_service:commands}}
\sphinxAtStartPar
\sphinxstylestrong{UserLoginCommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Initiates the process of logging a user into the system.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/login}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{username} (string, required): The username of the user.
\sphinxhyphen{} \sphinxtitleref{password} (string, required): The password of the user.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{token} (string): A JWT token for authenticated sessions.
\sphinxhyphen{} \sphinxtitleref{expiresIn} (int): Expiration time of the token in seconds.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{UserLoggedInEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{UserLogoutCommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Initiates the process of logging a user out of the system.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/logout}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}: None

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation message that the user has been logged out.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{UserLoggedOutEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{ResetPasswordCommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Resets the password for a user’s account.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/reset\sphinxhyphen{}password}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{email} (string, required): The email associated with the user’s account.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation that a password reset email has been sent.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{PasswordResetEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{Enable2FACommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Enables Two\sphinxhyphen{}Factor Authentication (2FA) for a user’s account.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/enable\sphinxhyphen{}2fa}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user enabling 2FA.
\sphinxhyphen{} \sphinxtitleref{token} (string, required): The 2FA token generated by the user’s authenticator app.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation that 2FA has been enabled.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{TwoFactorEnabledEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{Disable2FACommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Disables Two\sphinxhyphen{}Factor Authentication (2FA) for a user’s account.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/disable\sphinxhyphen{}2fa}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user disabling 2FA.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation that 2FA has been disabled.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{TwoFactorDisabledEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{VerifyEmailCommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Initiates the process of verifying a user’s email address.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/verify\sphinxhyphen{}email}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user verifying their email.
\sphinxhyphen{} \sphinxtitleref{emailToken} (string, required): The token sent to the user’s email.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation that the email has been verified.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{EmailVerifiedEvent}, \sphinxtitleref{EmailVerificationFailedEvent}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{RegisterConcessionCommand}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Registers a new concession within the system.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/register\sphinxhyphen{}concession}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{POST}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Body}:
\sphinxhyphen{} \sphinxtitleref{concessionName} (string, required): The name of the concession.
\sphinxhyphen{} \sphinxtitleref{adminEmail} (string, required): The email of the concession’s administrator.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{message} (string): Confirmation that the concession has been registered.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Events Triggered}: \sphinxtitleref{ConcessionRegisteredEvent}

\end{itemize}


\subsection{Queries}
\label{\detokenize{administration_concession_system/authorization_service:queries}}
\sphinxAtStartPar
\sphinxstylestrong{GetUserPermissionsQuery}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Retrieves the permissions associated with a user.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/get\sphinxhyphen{}user\sphinxhyphen{}permissions}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{GET}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Parameters}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user whose permissions are being retrieved.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{permissions} (array of strings): A list of permissions associated with the user.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{GetUserDetailsQuery}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Fetches the details of a specific user.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/get\sphinxhyphen{}user\sphinxhyphen{}details}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{GET}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Parameters}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user whose details are being fetched.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{userId} (string): The ID of the user.
\sphinxhyphen{} \sphinxtitleref{username} (string): The username of the user.
\sphinxhyphen{} \sphinxtitleref{email} (string): The email of the user.
\sphinxhyphen{} \sphinxtitleref{roles} (array of strings): A list of roles assigned to the user.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{Get2FAStatusQuery}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Retrieves the 2FA (Two\sphinxhyphen{}Factor Authentication) status of a user.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request URL}: \sphinxtitleref{/api/auth/get\sphinxhyphen{}2fa\sphinxhyphen{}status}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Method}: \sphinxtitleref{GET}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Request Parameters}:
\sphinxhyphen{} \sphinxtitleref{userId} (string, required): The ID of the user whose 2FA status is being retrieved.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Response}:
\sphinxhyphen{} \sphinxtitleref{is2FAEnabled} (boolean): Indicates whether 2FA is enabled for the user.

\end{itemize}


\subsection{Inbox Events}
\label{\detokenize{administration_concession_system/authorization_service:inbox-events}}
\sphinxAtStartPar
The Authorization Microservice processes the following inbox events:

\sphinxAtStartPar
\sphinxstylestrong{ChangeUserRightsEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: An event that triggers when a user’s rights are changed within the CRM system.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Source}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Updates the user’s permissions within the Administration Concession System to reflect the changes made in the CRM system.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{BlockUserAccessEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: An event that triggers when a user is blocked or suspended in the CRM system.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Source}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Immediately revokes the user’s access to the Administration Concession System, ensuring that the block is enforced across systems.

\end{itemize}


\subsection{Outbox Events}
\label{\detokenize{administration_concession_system/authorization_service:outbox-events}}
\sphinxAtStartPar
The Authorization Microservice emits the following outbox events:

\sphinxAtStartPar
\sphinxstylestrong{UserLoggedInEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after a successful user login within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the user’s login, updates session details, and triggers any necessary workflows.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{UserLoggedOutEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after a user logs out within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system that the user has logged out, updates session termination details, and triggers any cleanup actions.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{PasswordResetEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after a user’s password is reset within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the password reset, triggers email notifications, and updates security logs.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{TwoFactorEnabledEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after Two\sphinxhyphen{}Factor Authentication (2FA) is enabled for a user within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the 2FA enablement, updates user security settings, and ensures that 2FA is enforced consistently across systems.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{TwoFactorDisabledEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after Two\sphinxhyphen{}Factor Authentication (2FA) is disabled for a user within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the 2FA disablement, updates user security settings, and ensures that the change is reflected across systems.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{EmailVerifiedEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted when a user’s email is successfully verified within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the email verification, updates the user’s profile, and triggers any related workflows.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{EmailVerificationFailedEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted when a user’s email verification fails within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the failed verification, updates logs, and marks the user’s email as unverified.

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{ConcessionRegisteredEvent}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Description}: Emitted after a new concession is registered within the Administration Concession System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Destination}: CRM System.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Actions}: Notifies the CRM system of the new concession, triggers onboarding processes, and syncs concession details across systems.

\end{itemize}

\sphinxstepscope


\chapter{CRM System}
\label{\detokenize{crm_system/index:crm-system}}\label{\detokenize{crm_system/index::doc}}


\renewcommand{\indexname}{Index}
\printindex
\end{document}